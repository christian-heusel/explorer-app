---
- name: Check that the config files exist
  stat:
    path: "{{ item }}"
  register: stat_result
  with_items:
    - "explorer_app-server_db.env"
    - "explorer_app-server.env"

- name: create the .env files, if they dont exist already
  copy:
    src: "{{ project_root }}{{ project_name }}/server/{{ item }}"
    dest: "{{ project_root }}{{ project_name }}/server/{{ item.split('.')[0] + '.' + item.split('.')[1] }}"
    remote_src: yes
    mode: 0600
  with_items:
    - "explorer_app-server_db.env.example"
    - "explorer_app-server.env.example"
  when: not stat_result.stat.exists

- name: install docker-compose
  apt:
    name: docker-compose
    state: present

- name: build and start the docker image
  community.general.docker_compose:
    project_src: "{{ project_root }}{{ project_name }}"
    state: present